## This is general tooling do not put any PROJECT specific things here

if [[ -z ${NLS_LANG+x} ]] # check only once if already set ignore
then 

	if [[ $(chcp.com 2> /dev/null | grep 852) ]]
	then
		#export NLS_LANG=.EE8PC852 # UFT-8
		export NLS_LANG=.US7ASCII # orezane dlzdne a mekcene
		echo "sql: MINGW and 852 console detected, exporting \$NLS_LANG=$NLS_LANG" 1>&2
	elif [[ $(chcp.com 2> /dev/null | grep 65001) ]]
	then
		#export NLS_LANG=.UTF8 # UFT-8
		export NLS_LANG=.US7ASCII # orezane dlzdne a mekcene
		echo "sql: MINGW and 65001 console detected, exporting \$NLS_LANG=$NLS_LANG" 1>&2
	elif [[ $(locale LC_CTYPE 2> /dev/null | grep -e 'UTF-8') ]] 
	then
		export NLS_LANG=.UTF8 # UFT-8
		#export NLS_LANG=.US7ASCII # orezane dlzdne a mekcene
		echo "sql: OSX and UTF-8 console detected, exporting  \$NLS_LANG=$NLS_LANG" 1>&2
	else
		: # do not set anything for unknown clients	
		echo "sql: unknown console detected, not exporting \$NLS_LANG=$NLS_LANG" 1>&2
	fi
	
fi

#export NLS_LANG=American_America.UTF8 #fix issues with cropped or incorrect slovak chars

sql(){ #sql authenticated
	if [[ $# -eq 0 ]]
	then
		sqlplus -S $db_connection_str
	elif [[ $1 == @* ]]
	then
		sqlplus -S $db_connection_str "$@"
	else
		echo "$1" | sqlplus -S $db_connection_str
	fi
}

sql2(){ #todo multiple params
	# Easier SQL/plus (@see http://docs.oracle.com/cd/B19306_01/server.102/b14357/ch5.htm) Samples:
	#	sql2 "$sql_wide" "$sql_porcelain" @package-group-01-PMM_FM_402.sql SYSDATE  #specify formating, file and params on single command line
	#	sql2 "$sql_wide" "$sql_porcelain" "START package-group-01-PMM_FM_402.sql SYSDATE" # START+params supress prompt for values
	
	(
		for p in "$@" 
		do
			echo "$p"
		done
	) | sqlplus -S $db_connection_str
}
sql_login(){

	db_connection_str="$1/$2@$db_connection_server"
	sql "select USER from DUAL;"	
}
sqli(){
	# interactive sqlplus, just adding connection string now for cencenience
	sqlplus $db_connection_str
}
export sql_wide="
	SET PAGESIZE 9999
	SET LINESIZE 9999 
	SET WRAP OFF
	SET FEEDBACK OFF
"

#use when selecting big data or clobs
export sql_widest="
	SET PAGESIZE 9999 
	SET LINESIZE 32767 
	SET WRAP OFF
	SET FEEDBACK OFF
	
	SET LONG 100000
	SET LONGCHUNKSIZE 100000
"

export sql_porcelain="
	-- just minimal formating options for porcelain usage
	SET HEADING OFF
	SET PAGESIZE 0
	SET FEEDBACK OFF
	SET VERIFY OFF 
	--
"
# for better formatting
# COLSEP is TAB, TODO: review all usages it was by accident space
# GOAL is to have space as padding char and tab as column separator
export sql_tabs="
	SET TAB OFF
	SET COLSEP '	'
"
#export db_connection_str
#export db_connection_schema # default schema (owner) used in some queries where owner is optional

#export db_connection_aux_schemas # list of schemas in this form "'BEM','SCHEMA2'", set to "''" if not used 
